<?php
 namespace Xysdev\Admiflow; Config::load(); const LICENSE_SERVER_URL = "\x68\164\x74\160\163\x3a\x2f\x2f\170\x79\163\x64\x65\x76\x2e\x63\157\x6d\57\x61\160\151\57\166\145\x72\151\x66\x79\137\x6c\x69\143\x65\x6e\163\x65"; const CACHE_FILE = __DIR__ . "\57\x63\x61\x63\150\145\x2f\x6c\151\x63\x65\x6e\163\x65\x2e\x61\x64\155\x69\x66\154\x6f\x77"; const CACHE_EXPIRY_TIME = 3600; function get_license_key() : string { return Config::get("\x6c\x69\143\145\x6e\163\x65\x5f\153\x65\x79") ?? ''; } function get_cached_license() : array { if (!file_exists(CACHE_FILE)) { save_license_cache(array("\164\x69\x6d\x65\x73\x74\141\x6d\160" => 0, "\166\141\x6c\x69\x64" => false, "\165\163\x65\162\x5f\x69\144" => null)); return array("\164\x69\155\145\163\164\141\x6d\160" => 0, "\166\x61\x6c\151\x64" => false, "\165\x73\145\162\137\151\144" => null); } $content = file_get_contents(CACHE_FILE); $lines = explode("\12", trim($content)); $cache = array(); foreach ($lines as $line) { list($key, $value) = explode("\x3a\40", $line, 2); $cache[$key] = trim($value); } return array("\x74\151\x6d\145\163\x74\141\x6d\160" => (int) ($cache["\164\151\155\x65\x73\x74\141\x6d\160"] ?? 0), "\x76\x61\154\151\144" => filter_var($cache["\166\141\154\x69\144"] ?? false, FILTER_VALIDATE_BOOLEAN), "\165\x73\x65\162\137\151\x64" => $cache["\x75\x73\145\162\137\x69\x64"] ?? null); } function save_license_cache(array $data) : void { $content = sprintf("\x74\151\x6d\x65\163\x74\x61\x6d\160\72\x20\x25\x64\12\166\141\x6c\x69\144\72\40\x25\x73\12\x75\163\x65\x72\137\x69\144\x3a\40\x25\x73", time(), $data["\166\x61\x6c\x69\x64"] ? "\x74\x72\x75\x65" : "\146\141\x6c\x73\x65", $data["\x75\x73\x65\x72\137\x69\144"] ?? "\x6e\165\154\x6c"); file_put_contents(CACHE_FILE, $content); } function check_license() : array { $licenseKey = get_license_key(); error_log("\x4c\151\x63\145\156\163\x65\40\x4b\x65\x79\72\x20" . $licenseKey); if (empty($licenseKey)) { return array("\x76\x61\154\x69\x64" => false, "\165\163\x65\162\137\x69\x64" => null); } $context = stream_context_create(array("\x68\164\x74\160" => array("\x6d\145\164\x68\x6f\144" => "\107\x45\x54", "\150\145\141\144\x65\162" => "\x41\143\143\x65\x70\x74\72\40\141\x70\160\154\151\x63\x61\164\151\x6f\156\57\152\x73\x6f\x6e", "\164\x69\x6d\145\x6f\165\164" => 10))); $url = LICENSE_SERVER_URL . "\x3f\153\x65\171\x3d" . urlencode($licenseKey); $response = @file_get_contents($url, false, $context); if ($response === false) { error_log("\x48\x54\124\x50\40\105\x72\x72\157\x72\x3a\x20\x55\x6e\x61\142\x6c\145\40\164\x6f\40\x66\x65\x74\x63\150\40\162\145\x73\x70\157\x6e\x73\145\x20\x66\x72\157\155\x20\x55\x52\x4c\x3a\40" . $url); return array("\166\141\154\151\144" => false, "\165\163\145\x72\x5f\151\x64" => null); } $data = json_decode($response, true); if (json_last_error() !== JSON_ERROR_NONE) { error_log("\112\123\x4f\116\40\x44\x65\x63\157\x64\145\x20\105\x72\x72\x6f\162\x3a\40" . json_last_error_msg()); return array("\166\141\154\x69\144" => false, "\x75\x73\x65\x72\137\x69\144" => null); } error_log("\104\145\x63\157\x64\145\144\x20\104\141\164\x61\72\40" . print_r($data, true)); return array("\166\141\154\151\144" => isset($data["\x76\x61\154\151\144"]) && $data["\x76\x61\154\x69\144"] === true, "\x75\x73\x65\162\x5f\151\x64" => $data["\x75\163\145\162\137\151\x64"] ?? null); } function is_license_cache_valid() : bool { $cache = get_cached_license(); return time() - $cache["\x74\x69\x6d\145\x73\x74\141\155\160"] < CACHE_EXPIRY_TIME && $cache["\166\141\x6c\151\144"]; } if (!is_license_cache_valid()) { $licenseData = check_license(); save_license_cache($licenseData); } else { $licenseData = get_cached_license(); } error_log("\x4c\x69\x63\x65\x6e\x73\145\40\x44\x61\164\141\72\40" . print_r($licenseData, true)); if (!$licenseData["\x76\141\154\151\x64"]) { die("\114\x69\143\145\x6e\x63\151\x61\x20\x69\156\x76\303\xa1\154\x69\144\141\x2e\x20\114\141\40\141\x70\154\151\x63\x61\143\151\xc3\xb3\156\x20\x6e\x6f\40\x70\x75\145\144\x65\x20\x63\x6f\156\x74\151\156\165\141\x72\56"); } $user_id = $licenseData["\x75\x73\x65\162\x5f\151\144"]; ?>